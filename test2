class Solution {
public:
    void usp(int *pole, vector<int> nums, int low, int high, int part)
    {
        int index = low-1;
        int helper;
        for (int i = low; i < high; i++)
        {
            if (nums[i] < nums[part])
            {
                index++;
                helper = pole[i];
                pole[i] = pole[index];
                pole[index] = helper;
            }
        }
        index++;
        helper = pole[part];
        pole[part] = pole[index];
        pole[index] = helper;
        if (index - low > 1)
        {
            usp(pole, nums, low, index, index-1);
        }
        if (high - index > 1)
        {
            usp(pole, nums, index+1, high, high-1);
        }
    }
    
    int maxCoins(vector<int>& nums)
    {
        long long int answer = 0;
        int n = nums.size();
        int sus[n][2];
        int por[n];
        vector<int> zvys;
        if (n == 1)
        {
            return nums[0];
        }
        sus[0][0] = 1;
        sus[0][1] = nums[1];
        por[0] = 0;
        sus[n-1][0] = nums[n-2];
        sus[n-1][1] = 1;
        por[n-1] = n-1;
        for (int i = 1; i < n-1; i++)
        {
            sus[i][0] = nums[i-1];
            sus[i][1] = nums[i+1];
            por[i] = i;
        }
        usp(por, nums, 0, n, n-1);
        for (int i = 0; i < n; i++)
        {
            cout << nums[i] << " "; 
        }
        cout << "\n";
        /*for (int i = 0; i < n; i++)
        {
            cout << nums[por[i]] << " "; 
        }
        cout << "\n";*/
        for (int i = 0; i < n; i++)
        {
            if (por[i] > 0 && por[i] < n-1)
            {
                //cout << nums[por[i]] << " " << sus[por[i]][0] << " " << sus[por[i]][1] << "\n";
                answer += nums[por[i]] * sus[por[i]][0] * sus[por[i]][1];
                sus[por[i]-1][1] = nums[por[i]+1];
                sus[por[i]+1][0] = nums[por[i]-1];
            }
            else
            {
                zvys.push_back(por[i]);
            }
        }
        int zv0 = nums[zvys[0]];
        int zv1 = nums[zvys[1]];
        answer += zv0 * zv1;
        if (zv0 > zv1)
        {
            answer += zv0;
        }
        else
        {
            answer += zv1;
        }
        return answer;
    }
};
